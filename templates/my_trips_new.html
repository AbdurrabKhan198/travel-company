{% extends "base.html" %}
{% load static %}
{% load travel_filters %}
{% block title %}My Trips{% endblock %}
{% block extra_css %}
<style>
.trips-container{min-height:100vh;background:#f3f4f6;padding:2rem 1rem}
.trip-card{background:#fff;border-radius:12px;padding:1.5rem;margin-bottom:1rem;box-shadow:0 2px 8px rgba(0,0,0,.1);border-left:4px solid #0ea5e9}
.trip-card.cancelled{border-left-color:#ef4444}
.trip-card.past{border-left-color:#10b981}
.trip-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1rem;flex-wrap:wrap;gap:.5rem}
.trip-name{font-size:1.25rem;font-weight:700;color:#1f2937}
.trip-date{font-size:.875rem;color:#6b7280}
.badge{padding:.25rem .75rem;border-radius:20px;font-size:.75rem;font-weight:600}
.badge-success{background:#10b981;color:#fff}
.badge-danger{background:#ef4444;color:#fff}
.badge-warning{background:#f59e0b;color:#fff}
.route-display{display:flex;align-items:center;gap:1rem;background:#f8fafc;padding:1rem;border-radius:8px;margin-bottom:1rem}
.city{text-align:center}
.city-code{font-size:1.5rem;font-weight:800;color:#1e40af}
.route-line{flex:1;text-align:center;color:#0ea5e9}
.info-row{display:grid;grid-template-columns:repeat(2,1fr);gap:.5rem;margin-bottom:1rem}
@media(min-width:768px){.info-row{grid-template-columns:repeat(4,1fr)}}
.info-box{background:#f8fafc;padding:.5rem;border-radius:6px}
.info-label{font-size:.625rem;text-transform:uppercase;color:#6b7280;font-weight:600}
.info-value{font-size:.875rem;font-weight:600;color:#1f2937}
.btn{display:inline-block;padding:.5rem 1rem;border-radius:8px;font-weight:600;font-size:.875rem;text-decoration:none;margin-right:.5rem;margin-top:.5rem;border:none;cursor:pointer}
.btn-blue{background:#0ea5e9;color:#fff}
.btn-gray{background:#e5e7eb;color:#374151}
.btn-red{background:#ef4444;color:#fff}
.tabs{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1.5rem}
.tab{padding:.5rem 1rem;border-radius:8px;font-weight:600;text-decoration:none;background:#fff;color:#374151;border:1px solid #e5e7eb}
.tab.active{background:#0ea5e9;color:#fff;border-color:#0ea5e9}
.filter-box{background:#fff;padding:1rem;border-radius:12px;margin-bottom:1.5rem}
.wallet-info{background:#1e40af;color:#fff;padding:1rem;border-radius:12px;margin-bottom:1.5rem;display:flex;justify-content:space-between;flex-wrap:wrap;gap:1rem}
.empty-box{text-align:center;padding:3rem;background:#fff;border-radius:12px}
.passengers-box{background:#fef3c7;padding:.75rem;border-radius:8px;margin-bottom:1rem}
.passengers-box li{color:#92400e;padding:.125rem 0}
</style>
{% endblock %}
{% block content %}
<div class="trips-container">
<div class="container mx-auto max-w-4xl">
<h1 style="font-size:1.75rem;font-weight:700;margin-bottom:.5rem">My Trips</h1>
<p style="color:#6b7280;margin-bottom:1.5rem">View and manage your flight bookings</p>
<div class="wallet-info">
<div><i class="fas fa-wallet"></i> Cash Balance: <strong>â‚¹{{ cash_balance|floatformat:2 }}</strong></div>
<div><i class="fas fa-headset"></i> Help: 01244998999</div>
</div>
<div class="filter-box">
<form method="get" style="display:flex;flex-wrap:wrap;gap:.75rem;align-items:flex-end">
<div style="flex:1;min-width:120px">
<label style="font-size:.75rem;display:block;margin-bottom:.25rem">From Date</label>
<input type="date" name="from_date" value="{{ from_date }}" style="width:100%;padding:.5rem;border:1px solid #d1d5db;border-radius:6px">
</div>
<div style="flex:1;min-width:120px">
<label style="font-size:.75rem;display:block;margin-bottom:.25rem">To Date</label>
<input type="date" name="to_date" value="{{ to_date }}" style="width:100%;padding:.5rem;border:1px solid #d1d5db;border-radius:6px">
</div>
<input type="hidden" name="trip_type" value="{{ trip_type }}">
<button type="submit" class="btn btn-blue">Apply</button>
<a href="{% url 'my_trips' %}" class="btn btn-gray">Clear</a>
</form>
</div>
<div class="tabs">
<a href="?trip_type=all" class="tab {% if trip_type == 'all' %}active{% endif %}">All ({{ total_count }})</a>
<a href="?trip_type=upcoming" class="tab {% if trip_type == 'upcoming' %}active{% endif %}">Upcoming ({{ upcoming_count }})</a>
<a href="?trip_type=past" class="tab {% if trip_type == 'past' %}active{% endif %}">Past ({{ past_count }})</a>
<a href="?trip_type=cancelled" class="tab {% if trip_type == 'cancelled' %}active{% endif %}">Cancelled ({{ cancelled_count }})</a>
</div>
{% if bookings %}
{% for booking in bookings %}
<div class="trip-card {% if booking.status == 'cancelled' %}cancelled{% elif booking.schedule.departure_date < today %}past{% endif %}">
<div class="trip-header">
<div>
<div class="trip-name">{% with booking.passengers.first as p %}{{ p.first_name|upper }} {{ p.last_name|upper }}{% endwith %}</div>
<div class="trip-date">{{ booking.schedule.departure_date|date:"l, d F Y" }}</div>
</div>
<div>
{% if booking.status == 'cancelled' %}
<span class="badge badge-danger">Cancelled</span>
{% elif booking.payment_status == 'paid' and booking.status == 'confirmed' %}
<span class="badge badge-success">Ticketed</span>
{% else %}
<span class="badge badge-warning">Pending</span>
{% endif %}
</div>
</div>
<div class="route-display">
<div class="city"><div class="city-code">{{ booking.schedule.route.from_location }}</div></div>
<div class="route-line"><i class="fas fa-plane"></i> --------</div>
<div class="city"><div class="city-code">{{ booking.schedule.route.to_location }}</div></div>
</div>
<div class="info-row">
<div class="info-box"><div class="info-label">Flight</div><div class="info-value">{{ booking.schedule.route.carrier_number }}</div></div>
<div class="info-box"><div class="info-label">PNR</div><div class="info-value">{{ booking.booking_reference|slice:":6"|upper }}</div></div>
<div class="info-box"><div class="info-label">Ref No</div><div class="info-value">{{ booking.booking_reference }}</div></div>
<div class="info-box"><div class="info-label">Passengers</div><div class="info-value">{{ booking.passengers.count }} pax</div></div>
</div>
{% if booking.passengers.count > 1 %}
<div class="passengers-box">
<strong style="font-size:.75rem">All Passengers:</strong>
<ul style="list-style:decimal;padding-left:1.25rem;margin:.25rem 0 0">
{% for p in booking.passengers.all %}
<li>{{ p.first_name|upper }} {{ p.last_name|upper }}</li>
{% endfor %}
</ul>
</div>
{% endif %}
<div style="border-top:1px solid #e5e7eb;padding-top:.75rem">
<div style="display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:.5rem">
<a href="{% url 'fare_rule' booking.id %}" style="color:#6366f1;font-size:.875rem;text-decoration:none;font-weight:500"><i class="fas fa-file-contract"></i> Fare Rule</a>
<a href="{% url 'view_ticket' booking.id %}" target="_blank" style="color:#0ea5e9;font-size:.875rem;text-decoration:none;font-weight:500"><i class="fas fa-ticket-alt"></i> View Ticket</a>
<a href="{% url 'change_request' booking.id %}" style="color:#a855f7;font-size:.875rem;text-decoration:none;font-weight:500"><i class="fas fa-edit"></i> Change Request</a>
</div>
<div style="display:flex;flex-wrap:wrap;gap:.5rem;align-items:center">
{% if booking.payment_status == 'paid' and booking.status == 'confirmed' %}
<a href="{% url 'booking_confirmation' booking.id %}" class="btn" style="background:#f59e0b;color:#fff"><i class="fas fa-file-invoice"></i> View Invoice</a>
<a href="{% url 'view_ticket' booking.id %}" target="_blank" class="btn btn-blue"><i class="fas fa-external-link-alt"></i> Open</a>
{% else %}
<a href="{% url 'booking_confirmation' booking.id %}" class="btn btn-gray"><i class="fas fa-file-invoice"></i> Invoice</a>
{% endif %}
</div>
</div>
</div>
{% endfor %}
{% else %}
<div class="empty-box">
<i class="fas fa-plane-slash" style="font-size:3rem;color:#9ca3af;margin-bottom:1rem"></i>
<h3 style="font-size:1.25rem;font-weight:700;margin-bottom:.5rem">No Trips Found</h3>
<p style="color:#6b7280;margin-bottom:1rem">You haven't made any bookings yet.</p>
<a href="{% url 'home' %}" class="btn btn-blue">Search Flights</a>
</div>
{% endif %}
</div>
</div>
{% endblock %}
