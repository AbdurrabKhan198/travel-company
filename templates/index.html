{% extends "base.html" %}
{% load static %}
{% load travel_filters %}

{% block title %}Safar Zone - Explore the World{% endblock %}

{% block extra_css %}
<style>
    /* Animated background */
    @keyframes gradient-shift {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }
    
    .hero-gradient {
        background: linear-gradient(-45deg, #38bdf8, #0ea5e9, #0284c7, #0369a1);
        background-size: 400% 400%;
        animation: gradient-shift 15s ease infinite;
    }
    
    /* Floating animation */
    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(5deg); }
    }
    
    .float-animation {
        animation: float 6s ease-in-out infinite;
    }
    
    /* Glassmorphism card */
    .glass-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    /* Pulse animation */
    @keyframes pulse-glow {
        0%, 100% { box-shadow: 0 0 20px rgba(56, 189, 248, 0.5); }
        50% { box-shadow: 0 0 40px rgba(56, 189, 248, 0.8); }
    }
    
    .pulse-glow {
        animation: pulse-glow 2s ease-in-out infinite;
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section with Search -->
<section class="hero-gradient relative min-h-screen flex items-center justify-center overflow-hidden pt-20">
    <!-- Animated Background Elements -->
    <div class="absolute inset-0 overflow-hidden">
        <div class="absolute top-20 left-10 w-72 h-72 bg-white/10 rounded-full blur-3xl float-animation"></div>
        <div class="absolute bottom-20 right-10 w-96 h-96 bg-white/10 rounded-full blur-3xl float-animation" style="animation-delay: 2s;"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-white/5 rounded-full blur-3xl float-animation" style="animation-delay: 4s;"></div>
    </div>
    
    <div class="container mx-auto px-4 relative z-10">
        <div class="max-w-7xl mx-auto">
            <div class="grid lg:grid-cols-2 gap-12 items-center">
                <!-- Left Content -->
                <div class="text-white space-y-8 animate-fade-in-up">
                    <div class="space-y-4">
                        <div class="inline-block px-4 py-2 bg-white/20 backdrop-blur-md rounded-full text-sm font-semibold">
                            <i class="fas fa-star text-yellow-300 mr-2"></i>
                            Trusted by 10,000+ Travelers
                        </div>
                        <h1 class="text-5xl md:text-6xl lg:text-7xl font-bold leading-tight">
                            Discover Amazing
                            <span class="block bg-gradient-to-r from-yellow-300 to-orange-300 bg-clip-text text-transparent">
                                Destinations
                            </span>
                        </h1>
                        <p class="text-xl md:text-2xl text-white/90 leading-relaxed">
                            Find and book incredible flight experiences around the world. Your next adventure starts here!
                        </p>
                    </div>
                    
                    <div class="flex flex-wrap gap-4">
                        <div class="flex items-center space-x-2 bg-white/10 backdrop-blur-md rounded-lg px-4 py-2">
                            <i class="fas fa-check-circle text-green-300"></i>
                            <span class="text-sm font-medium">Best Prices</span>
                        </div>
                        <div class="flex items-center space-x-2 bg-white/10 backdrop-blur-md rounded-lg px-4 py-2">
                            <i class="fas fa-shield-alt text-blue-300"></i>
                            <span class="text-sm font-medium">Secure Booking</span>
                        </div>
                        <div class="flex items-center space-x-2 bg-white/10 backdrop-blur-md rounded-lg px-4 py-2">
                            <i class="fas fa-headset text-purple-300"></i>
                            <span class="text-sm font-medium">24/7 Support</span>
                        </div>
                    </div>
                </div>
                
                <!-- Right Search Form -->
                <div class="animate-fade-in-up" style="animation-delay: 0.2s;">
                    <div class="glass-card rounded-3xl p-8 shadow-2xl">
                        <div class="text-center mb-6">
                            <h2 class="text-2xl font-bold text-white mb-2">Search Flights</h2>
                            <p class="text-white/80">Find the best deals for your journey</p>
                        </div>
                        
                        <form method="GET" action="{% url 'search_flights' %}" class="space-y-4">
                            <!-- Route Type -->
                            <div class="grid grid-cols-2 gap-3">
                                <label class="relative">
                                    <input type="radio" name="route_type" value="domestic" checked class="peer hidden">
                                    <div class="glass-card rounded-xl p-4 text-center cursor-pointer transition-all duration-200 peer-checked:bg-white/20 peer-checked:ring-2 peer-checked:ring-white/50">
                                        <i class="fas fa-home text-2xl mb-2 block"></i>
                                        <span class="text-white font-medium">Domestic</span>
                                    </div>
                                </label>
                                <label class="relative">
                                    <input type="radio" name="route_type" value="international" class="peer hidden">
                                    <div class="glass-card rounded-xl p-4 text-center cursor-pointer transition-all duration-200 peer-checked:bg-white/20 peer-checked:ring-2 peer-checked:ring-white/50">
                                        <i class="fas fa-globe text-2xl mb-2 block"></i>
                                        <span class="text-white font-medium">International</span>
                                    </div>
                                </label>
                            </div>
                            
                            <!-- From Location -->
                            <div>
                                <label class="block text-white/90 text-sm font-medium mb-2">
                                    <i class="fas fa-map-marker-alt mr-2"></i>From
                                </label>
                                <input type="text" 
                                       name="from_location" 
                                       id="from_location"
                                       list="origin-suggestions"
                                       placeholder="Type city or airport code (e.g., DEL, Mumbai)"
                                       autocomplete="off"
                                       class="w-full px-4 py-3 rounded-xl bg-white/90 backdrop-blur-md border-2 border-white/20 focus:border-white/50 focus:outline-none focus:ring-2 focus:ring-white/30 transition-all text-gray-800 placeholder-gray-500"
                                       required>
                                <datalist id="origin-suggestions">
                                    <!-- Options will be populated dynamically when user types -->
                                    {% for origin in origins %}
                                        <option value="{{ origin }}{% if origin in airport_codes %} ({{ airport_codes|get_item:origin }}){% endif %}" data-value="{{ origin }}" data-city="{{ origin|lower }}" data-code="{% if origin in airport_codes %}{{ airport_codes|get_item:origin|lower }}{% endif %}" style="display: none;">
                                    {% endfor %}
                                </datalist>
                            </div>
                            
                            <!-- To Location -->
                            <div>
                                <label class="block text-white/90 text-sm font-medium mb-2">
                                    <i class="fas fa-map-marker-alt mr-2"></i>To
                                </label>
                                <input type="text" 
                                       name="to_location" 
                                       id="to_location"
                                       list="destination-suggestions"
                                       placeholder="Type city or airport code (e.g., BOM, Delhi)"
                                       autocomplete="off"
                                       class="w-full px-4 py-3 rounded-xl bg-white/90 backdrop-blur-md border-2 border-white/20 focus:border-white/50 focus:outline-none focus:ring-2 focus:ring-white/30 transition-all text-gray-800 placeholder-gray-500"
                                       required>
                                <datalist id="destination-suggestions">
                                    <!-- Options will be populated dynamically when user types -->
                                    {% for destination in destinations %}
                                        <option value="{{ destination }}{% if destination in airport_codes %} ({{ airport_codes|get_item:destination }}){% endif %}" data-value="{{ destination }}" data-city="{{ destination|lower }}" data-code="{% if destination in airport_codes %}{{ airport_codes|get_item:destination|lower }}{% endif %}" style="display: none;">
                                    {% endfor %}
                                </datalist>
                            </div>
                            
                            <!-- Date and Passengers -->
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-white/90 text-sm font-medium mb-2">
                                        <i class="fas fa-calendar-alt mr-2"></i>Date
                                    </label>
                                    <input type="date" 
                                           name="travel_date" 
                                           id="travel_date"
                                           min="{{ today }}"
                                           class="w-full px-4 py-3 rounded-xl bg-white/90 backdrop-blur-md border-2 border-white/20 focus:border-white/50 focus:outline-none focus:ring-2 focus:ring-white/30 transition-all text-gray-800"
                                           required>
                                    <small class="text-white/70 text-xs mt-1 block">Only available dates</small>
                                </div>
                                <div>
                                    <label class="block text-white/90 text-sm font-medium mb-2">
                                        <i class="fas fa-users mr-2"></i>Passengers
                                    </label>
                                    <select name="passengers" 
                                            id="passengers"
                                            class="w-full px-4 py-3 rounded-xl bg-white/90 backdrop-blur-md border-2 border-white/20 focus:border-white/50 focus:outline-none focus:ring-2 focus:ring-white/30 transition-all text-gray-800"
                                            required>
                                        <option value="1">1 Adult</option>
                                        <option value="2">2 Adults</option>
                                        <option value="3">3 Adults</option>
                                        <option value="4">4 Adults</option>
                                        <option value="5">5 Adults</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Search Button -->
                            <button type="submit" class="w-full py-4 rounded-xl bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600 text-white font-bold text-lg shadow-2xl transform hover:scale-105 transition-all duration-200 pulse-glow">
                                <i class="fas fa-search mr-2"></i>
                                Search Flights
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scroll Indicator -->
    <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 animate-bounce">
        <i class="fas fa-chevron-down text-white/60 text-2xl"></i>
    </div>
</section>

<!-- Popular Destinations -->
<section id="destinations" class="py-20 bg-gradient-to-b from-white to-gray-50">
    <div class="container mx-auto px-4">
        <div class="text-center mb-16">
            <div class="inline-block px-4 py-2 bg-sky-100 text-sky-600 rounded-full text-sm font-semibold mb-4">
                <i class="fas fa-star mr-2"></i>Popular Destinations
            </div>
            <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                Explore Amazing <span class="gradient-text">Places</span>
            </h2>
            <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                Discover breathtaking destinations around the world with our curated travel packages
            </p>
        </div>
        
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for package in packages|slice:":6" %}
            <div class="group relative bg-white rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2">
                <div class="relative h-64 overflow-hidden">
                    {% if package.images.first %}
                    <img src="{{ package.images.first.image.url }}" alt="{{ package.title }}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500">
                    {% else %}
                    <div class="w-full h-full bg-gradient-to-br from-sky-400 to-blue-600 flex items-center justify-center">
                        <i class="fas fa-image text-white text-5xl opacity-50"></i>
                    </div>
                    {% endif %}
                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                    <div class="absolute bottom-4 left-4 right-4">
                        <div class="flex items-center justify-between text-white">
                            <span class="px-3 py-1 bg-white/20 backdrop-blur-md rounded-full text-sm font-semibold">
                                <i class="fas fa-map-marker-alt mr-1"></i>{{ package.destination }}
                            </span>
                            <span class="px-3 py-1 bg-yellow-400 text-gray-900 rounded-full text-sm font-bold">
                                â‚¹{{ package.price }}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-2">{{ package.title }}</h3>
                    <p class="text-gray-600 mb-4 line-clamp-2">{{ package.short_description }}</p>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-1 text-yellow-400">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <span class="text-gray-600 ml-2 text-sm">4.8</span>
                        </div>
                        <a href="#" class="px-4 py-2 bg-gradient-to-r from-sky-500 to-blue-600 text-white rounded-lg font-semibold hover:from-sky-600 hover:to-blue-700 transition-all duration-200 transform hover:scale-105">
                            View Details
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Features Section -->
<section id="packages" class="py-20 bg-white">
    <div class="container mx-auto px-4">
        <div class="text-center mb-16">
            <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                Why Choose <span class="gradient-text">Safar Zone</span>
            </h2>
            <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                We provide the best travel experience with our premium services
            </p>
        </div>
        
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
            <div class="text-center p-8 rounded-2xl bg-gradient-to-br from-sky-50 to-blue-50 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
                <div class="w-20 h-20 bg-gradient-to-br from-sky-400 to-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg">
                    <i class="fas fa-dollar-sign text-white text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-3">Best Prices</h3>
                <p class="text-gray-600">Get the best deals and competitive prices for all your travel needs</p>
            </div>
            
            <div class="text-center p-8 rounded-2xl bg-gradient-to-br from-green-50 to-emerald-50 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
                <div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg">
                    <i class="fas fa-shield-alt text-white text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-3">Secure Booking</h3>
                <p class="text-gray-600">Your data and payments are protected with industry-leading security</p>
            </div>
            
            <div class="text-center p-8 rounded-2xl bg-gradient-to-br from-purple-50 to-pink-50 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
                <div class="w-20 h-20 bg-gradient-to-br from-purple-400 to-pink-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg">
                    <i class="fas fa-headset text-white text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-3">24/7 Support</h3>
                <p class="text-gray-600">Round-the-clock customer support to assist you anytime, anywhere</p>
            </div>
            
            <div class="text-center p-8 rounded-2xl bg-gradient-to-br from-orange-50 to-red-50 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
                <div class="w-20 h-20 bg-gradient-to-br from-orange-400 to-red-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg">
                    <i class="fas fa-plane text-white text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-3">Easy Booking</h3>
                <p class="text-gray-600">Simple and fast booking process to get you on your journey quickly</p>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="py-20 bg-gradient-to-r from-sky-500 via-blue-600 to-indigo-700 relative overflow-hidden">
    <div class="absolute inset-0 opacity-10">
        <div class="absolute top-0 left-0 w-full h-full" style="background-image: url('data:image/svg+xml,%3Csvg width=\"60\" height=\"60\" viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cg fill=\"none\" fill-rule=\"evenodd\"%3E%3Cg fill=\"%23ffffff\" fill-opacity=\"1\"%3E%3Cpath d=\"M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
    </div>
    
    <div class="container mx-auto px-4 relative z-10">
        <div class="max-w-4xl mx-auto text-center text-white">
            <h2 class="text-4xl md:text-5xl font-bold mb-6">Ready to Start Your Journey?</h2>
            <p class="text-xl mb-8 text-white/90">Join thousands of happy travelers and book your next adventure today</p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="{% url 'search_flights' %}" class="px-8 py-4 bg-white text-sky-600 rounded-xl font-bold text-lg hover:bg-gray-100 transition-all duration-200 transform hover:scale-105 shadow-2xl">
                    <i class="fas fa-search mr-2"></i>Search Flights
                </a>
                <a href="{% url 'signup' %}" class="px-8 py-4 bg-yellow-400 text-gray-900 rounded-xl font-bold text-lg hover:bg-yellow-500 transition-all duration-200 transform hover:scale-105 shadow-2xl">
                    <i class="fas fa-user-plus mr-2"></i>Create Account
                </a>
            </div>
        </div>
    </div>
</section>

<script>
    // Store original options for filtering
    const originalOptions = {
        origin: [],
        destination: []
    };
    
    // Remove duplicate options from datalist and store originals
    function removeDuplicateOptions(datalistId) {
        const datalist = document.getElementById(datalistId);
        if (!datalist) return;
        
        const options = Array.from(datalist.options);
        const seen = new Set();
        const uniqueOptions = [];
        
        options.forEach(option => {
            const value = option.value.trim();
            if (value && !seen.has(value)) {
                seen.add(value);
                uniqueOptions.push(option);
            }
        });
        
        // Store original options for filtering
        if (datalistId === 'origin-suggestions') {
            originalOptions.origin = uniqueOptions.map(opt => opt.cloneNode(true));
        } else if (datalistId === 'destination-suggestions') {
            originalOptions.destination = uniqueOptions.map(opt => opt.cloneNode(true));
        }
        
        // Clear datalist initially - options will only show when user types
        datalist.innerHTML = '';
    }
    
    // Filter datalist options based on input
    function filterDatalist(input, datalistId, originalOptionsKey) {
        const datalist = document.getElementById(datalistId);
        if (!datalist || !originalOptions[originalOptionsKey]) return;
        
        const searchTerm = input.value.toLowerCase().trim();
        
        // Clear current options
        datalist.innerHTML = '';
        
        // If search term is empty, show NO options (user must type to see suggestions)
        if (!searchTerm) {
            return;
        }
        
        // Filter options that match search term
        const filteredOptions = originalOptions[originalOptionsKey].filter(option => {
            const city = option.dataset.city || '';
            const code = option.dataset.code || '';
            const value = option.value.toLowerCase();
            
            // Match if search term is in city name, airport code, or full value
            return city.includes(searchTerm) || 
                   code.includes(searchTerm) || 
                   value.includes(searchTerm);
        });
        
        // Add filtered options to datalist only if there's a search term
        filteredOptions.forEach(option => {
            datalist.appendChild(option.cloneNode(true));
        });
    }
    
    // Handle autocomplete input processing
    document.addEventListener('DOMContentLoaded', function() {
        // Remove duplicates from datalists and store originals
        removeDuplicateOptions('origin-suggestions');
        removeDuplicateOptions('destination-suggestions');
        
        const fromInput = document.getElementById('from_location');
        const toInput = document.getElementById('to_location');
        const searchForm = document.querySelector('form[action*="search_flights"]');
        
        // Add input event listeners for filtering
        if (fromInput) {
            fromInput.addEventListener('input', function() {
                filterDatalist(this, 'origin-suggestions', 'origin');
            });
            
            // Clear options on focus if input is empty (don't show anything until user types)
            fromInput.addEventListener('focus', function() {
                if (!this.value.trim()) {
                    const datalist = document.getElementById('origin-suggestions');
                    if (datalist) {
                        datalist.innerHTML = '';
                    }
                }
            });
        }
        
        if (toInput) {
            toInput.addEventListener('input', function() {
                filterDatalist(this, 'destination-suggestions', 'destination');
            });
            
            // Clear options on focus if input is empty (don't show anything until user types)
            toInput.addEventListener('focus', function() {
                if (!this.value.trim()) {
                    const datalist = document.getElementById('destination-suggestions');
                    if (datalist) {
                        datalist.innerHTML = '';
                    }
                }
            });
        }
        
        function processAutocompleteInput(input, datalistId) {
            const datalist = document.getElementById(datalistId);
            if (datalist) {
                const options = Array.from(datalist.options);
                const matchingOption = options.find(option => option.value === input.value);
                if (matchingOption && matchingOption.dataset.value) {
                    input.value = matchingOption.dataset.value;
                    return;
                }
            }
            // Extract city name if format is "City (CODE)"
            const match = input.value.match(/^(.+?)(\s*\([^)]+\))?$/);
            if (match && match[1]) {
                input.value = match[1].trim();
            }
        }
        
        if (searchForm) {
            searchForm.addEventListener('submit', function(e) {
                // Process inputs before form submission
                if (fromInput) {
                    processAutocompleteInput(fromInput, 'origin-suggestions');
                    // Ensure we have a value
                    if (!fromInput.value.trim()) {
                        e.preventDefault();
                        alert('Please select a departure city.');
                        fromInput.focus();
                        return false;
                    }
                }
                if (toInput) {
                    processAutocompleteInput(toInput, 'destination-suggestions');
                    // Ensure we have a value
                    if (!toInput.value.trim()) {
                        e.preventDefault();
                        alert('Please select a destination city.');
                        toInput.focus();
                        return false;
                    }
                }
                
                // Check if from and to are the same
                if (fromInput && toInput) {
                    const fromValue = fromInput.value.trim();
                    const toValue = toInput.value.trim();
                    
                    // Extract city names for comparison
                    const fromCity = fromValue.match(/^(.+?)(\s*\([^)]+\))?$/)?.[1]?.trim() || fromValue;
                    const toCity = toValue.match(/^(.+?)(\s*\([^)]+\))?$/)?.[1]?.trim() || toValue;
                    
                    if (fromCity === toCity) {
                        e.preventDefault();
                        alert('Departure and destination cannot be the same.');
                        return false;
                    }
                }
            });
        }
        
        // Date validation
        const travelDateInput = document.getElementById('travel_date');
        const availableDates = {{ available_dates|safe|default:"[]" }};
        
        if (travelDateInput && availableDates && availableDates.length > 0) {
            travelDateInput.addEventListener('input', function() {
                const selectedDate = this.value;
                if (selectedDate && !availableDates.includes(selectedDate)) {
                    alert('Selected date does not have available tickets. Please select from available dates.');
                    this.value = '';
                }
            });
        }
    });
</script>
{% endblock %}
